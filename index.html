<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GlassMap - 免费开源导航</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- 开源地图库 -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- 路线规划库 -->
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2574A9',
            secondary: '#26A65B',
            accent: '#F9BF3B',
            danger: '#C0392B',
          },
          fontFamily: {
            sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .glass {
        background: rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      }
      .glass-dark {
        background: rgba(20, 20, 25, 0.7);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .glass-input {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.12);
      }
      .glass-input:focus {
        border-color: theme('colors.primary');
        box-shadow: 0 0 0 2px rgba(37, 116, 169, 0.2);
      }
      .animate-float {
        animation: float 6s ease-in-out infinite;
      }
      .animate-pulse-slow {
        animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .animate-scale {
        transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }
      .animate-scale:hover {
        transform: scale(1.03);
      }
      .animate-slide-up {
        animation: slideUp 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
      }
      .animate-fade-in {
        animation: fadeIn 0.5s ease forwards;
      }
      .animate-ripple {
        position: relative;
        overflow: hidden;
      }
      .animate-ripple::after {
        content: "";
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
        background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
        background-repeat: no-repeat;
        background-position: 50%;
        transform: scale(10, 10);
        opacity: 0;
        transition: transform 0.5s, opacity 0.3s;
      }
      .animate-ripple:active::after {
        transform: scale(0, 0);
        opacity: 0.3;
        transition: 0s;
      }
      .map-control {
        @apply glass rounded-lg p-2 flex items-center justify-center text-white hover:bg-white/20 transition-all duration-300 animate-ripple;
      }
      .search-result {
        @apply glass rounded-lg p-3 mb-2 cursor-pointer hover:bg-white/10 transition-all duration-300 animate-scale;
      }
      .nav-item {
        @apply flex items-center space-x-2 p-3 rounded-lg hover:bg-white/10 transition-all duration-300;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
      }
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800 text-white min-h-screen overflow-hidden font-sans">
  <!-- 背景装饰 -->
  <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
    <div class="absolute top-[-200px] left-[5%] w-[400px] h-[400px] rounded-full bg-primary/20 blur-[120px] animate-pulse-slow"></div>
    <div class="absolute bottom-[-150px] right-[10%] w-[300px] h-[300px] rounded-full bg-secondary/20 blur-[100px] animate-pulse-slow" style="animation-delay: 1.5s;"></div>
  </div>

  <!-- 主容器 -->
  <div class="relative z-10 flex flex-col h-screen">
    <!-- 顶部导航栏 -->
    <header class="glass-dark py-3 px-4 md:px-6 z-30">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center animate-float">
            <i class="fa fa-map-marker text-xl"></i>
          </div>
          <h1 class="text-xl font-semibold tracking-tight">GlassMap</h1>
        </div>
        
        <div class="flex items-center space-x-2 md:space-x-4">
          <button id="themeToggle" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-white/10 transition-all duration-300 animate-ripple">
            <i class="fa fa-moon-o"></i>
          </button>
          <button id="userProfile" class="w-9 h-9 rounded-full overflow-hidden border border-white/20">
            <img src="https://picsum.photos/id/64/100/100" alt="用户头像" class="w-full h-full object-cover">
          </button>
        </div>
      </div>
    </header>

    <!-- 搜索区域 -->
    <div class="px-4 md:px-6 pt-4 pb-2 z-20">
      <div class="relative max-w-2xl mx-auto">
        <div class="glass rounded-xl p-1.5 flex items-center">
          <div class="flex-1 flex items-center px-3">
            <i class="fa fa-search text-gray-300 mr-3"></i>
            <div class="flex flex-col w-full">
              <input type="text" id="startPoint" placeholder="您的位置" class="glass-input w-full py-2 px-3 rounded-lg text-white placeholder-gray-400 focus:outline-none text-sm md:text-base">
              <div class="w-full h-0.5 bg-gradient-to-r from-transparent via-white/30 to-transparent my-1"></div>
              <input type="text" id="endPoint" placeholder="目的地" class="glass-input w-full py-2 px-3 rounded-lg text-white placeholder-gray-400 focus:outline-none text-sm md:text-base">
            </div>
          </div>
          <button id="searchBtn" class="glass bg-primary hover:bg-primary/90 text-white rounded-lg px-4 py-3 mx-1.5 text-sm md:text-base font-medium transition-all duration-300 animate-ripple animate-scale">
            导航
          </button>
        </div>
        
        <!-- 搜索结果容器 -->
        <div id="searchResults" class="absolute top-full left-0 right-0 mt-2 glass rounded-xl max-h-80 overflow-y-auto scrollbar-hide z-50 hidden animate-slide-up">
          <!-- 搜索结果会动态插入这里 -->
        </div>
      </div>
    </div>

    <!-- 地图容器 -->
    <div class="flex-1 relative">
      <div id="map" class="w-full h-full rounded-t-3xl -mt-2 overflow-hidden"></div>
      
      <!-- 地图控制器 -->
      <div class="absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col space-y-3 z-10">
        <button id="zoomIn" class="map-control w-10 h-10">
          <i class="fa fa-plus"></i>
        </button>
        <button id="zoomOut" class="map-control w-10 h-10">
          <i class="fa fa-minus"></i>
        </button>
        <button id="myLocation" class="map-control w-10 h-10">
          <i class="fa fa-location-arrow"></i>
        </button>
        <button id="mapType" class="map-control w-10 h-10">
          <i class="fa fa-map"></i>
        </button>
      </div>
      
      <!-- 底部导航信息 -->
      <div id="routeInfo" class="absolute bottom-0 left-0 right-0 glass-dark rounded-t-3xl p-4 md:p-6 transform translate-y-full transition-transform duration-500 ease-in-out z-20">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">导航路线</h2>
          <div class="flex space-x-2">
            <button class="route-type-btn active px-3 py-1.5 rounded-full text-sm bg-primary/20 border border-primary/30">
              <i class="fa fa-car mr-1"></i> 驾车
            </button>
            <button class="route-type-btn px-3 py-1.5 rounded-full text-sm bg-white/5 border border-white/10 hover:bg-white/10 transition-colors">
              <i class="fa fa-bus mr-1"></i> 公交
            </button>
            <button class="route-type-btn px-3 py-1.5 rounded-full text-sm bg-white/5 border border-white/10 hover:bg-white/10 transition-colors">
              <i class="fa fa-male mr-1"></i> 步行
            </button>
          </div>
        </div>
        
        <div class="flex justify-between items-center mb-6">
          <div class="text-center">
            <p class="text-gray-400 text-xs">距离</p>
            <p id="routeDistance" class="text-2xl font-bold">0.0 公里</p>
          </div>
          <div class="text-center">
            <p class="text-gray-400 text-xs">预计时间</p>
            <p id="routeDuration" class="text-2xl font-bold">0 分钟</p>
          </div>
          <div class="text-center">
            <p class="text-gray-400 text-xs">红绿灯</p>
            <p id="routeLights" class="text-2xl font-bold">0 个</p>
          </div>
          <div class="text-center">
            <p class="text-gray-400 text-xs">油耗</p>
            <p id="routeFuel" class="text-2xl font-bold">0.0 升</p>
          </div>
        </div>
        
        <div class="space-y-3 max-h-40 overflow-y-auto scrollbar-hide pr-2">
          <div id="routeSteps" class="space-y-3">
            <!-- 路线步骤会动态插入这里 -->
          </div>
        </div>
        
        <div class="mt-6 flex space-x-3">
          <button id="startNavBtn" class="flex-1 glass bg-primary hover:bg-primary/90 text-white rounded-xl py-3.5 text-base font-medium transition-all duration-300 animate-ripple animate-scale">
            <i class="fa fa-location-arrow mr-2"></i> 开始导航
          </button>
          <button id="closeRouteBtn" class="w-12 h-12 glass rounded-xl flex items-center justify-center hover:bg-white/10 transition-all duration-300 animate-ripple">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      
      <!-- 显示/隐藏路线信息按钮 -->
      <button id="toggleRouteBtn" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 glass-dark w-12 h-12 rounded-full flex items-center justify-center z-20 animate-ripple">
        <i class="fa fa-chevron-up" id="routeChevron"></i>
      </button>
    </div>

    <!-- 底部功能栏 -->
    <footer class="glass-dark py-3 px-6 z-30">
      <div class="flex justify-around">
        <button class="nav-item flex flex-col items-center">
          <i class="fa fa-compass text-xl text-primary"></i>
          <span class="text-xs mt-1">导航</span>
        </button>
        <button class="nav-item flex flex-col items-center">
          <i class="fa fa-map text-xl"></i>
          <span class="text-xs mt-1">地图</span>
        </button>
        <button class="nav-item flex flex-col items-center">
          <i class="fa fa-star-o text-xl"></i>
          <span class="text-xs mt-1">收藏</span>
        </button>
        <button class="nav-item flex flex-col items-center">
          <i class="fa fa-history text-xl"></i>
          <span class="text-xs mt-1">历史</span>
        </button>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化地图
      let map = L.map('map').setView([39.9042, 116.4074], 13); // 默认北京
      let routingControl = null;
      let currentPosition = null;
      let startMarker = null;
      let endMarker = null;
      let mapStyle = 'dark'; // 默认深色模式
      
      // 添加地图图层（深色风格）
      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
      }).addTo(map);
      
      // 浅色地图图层URL
      const lightMapUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
      
      // 获取当前位置
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            currentPosition = [position.coords.latitude, position.coords.longitude];
            map.setView(currentPosition, 15);
            
            // 添加当前位置标记
            L.marker(currentPosition, {
              icon: L.divIcon({
                html: '<div class="w-6 h-6 bg-primary rounded-full border-2 border-white shadow-lg animate-ping"></div><div class="w-4 h-4 bg-primary rounded-full border-2 border-white shadow-lg -mt-6 ml-1"></div>',
                className: 'custom-marker',
                iconSize: [12, 12]
              })
            }).addTo(map);
            
            // 自动填充起点
            document.getElementById('startPoint').value = '我的位置';
          },
          (error) => {
            showToast('无法获取位置信息，请手动输入');
          }
        );
      } else {
        showToast('您的浏览器不支持地理位置功能');
      }

      // DOM元素
      const startPoint = document.getElementById('startPoint');
      const endPoint = document.getElementById('endPoint');
      const searchBtn = document.getElementById('searchBtn');
      const searchResults = document.getElementById('searchResults');
      const zoomIn = document.getElementById('zoomIn');
      const zoomOut = document.getElementById('zoomOut');
      const myLocation = document.getElementById('myLocation');
      const mapTypeBtn = document.getElementById('mapType');
      const routeInfo = document.getElementById('routeInfo');
      const toggleRouteBtn = document.getElementById('toggleRouteBtn');
      const routeChevron = document.getElementById('routeChevron');
      const closeRouteBtn = document.getElementById('closeRouteBtn');
      const startNavBtn = document.getElementById('startNavBtn');
      const routeDistance = document.getElementById('routeDistance');
      const routeDuration = document.getElementById('routeDuration');
      const routeLights = document.getElementById('routeLights');
      const routeFuel = document.getElementById('routeFuel');
      const routeSteps = document.getElementById('routeSteps');
      const routeTypeBtns = document.querySelectorAll('.route-type-btn');
      const themeToggle = document.getElementById('themeToggle');

      // 变量
      let isRouteVisible = false;
      let routeType = 'driving'; // 默认驾车模式

      // 搜索框事件
      startPoint.addEventListener('focus', function() {
        searchResults.innerHTML = '';
        searchResults.classList.remove('hidden');
      });

      endPoint.addEventListener('focus', function() {
        searchResults.innerHTML = '';
        searchResults.classList.remove('hidden');
      });

      // 点击其他区域关闭搜索结果
      document.addEventListener('click', function(e) {
        if (!e.target.closest('#startPoint') && !e.target.closest('#endPoint') && !e.target.closest('#searchResults')) {
          searchResults.classList.add('hidden');
        }
      });

      // 输入框搜索（使用Nominatim开放地理编码服务）
      [startPoint, endPoint].forEach(input => {
        input.addEventListener('input', function() {
          const keyword = this.value.trim();
          if (keyword.length < 2) return;
          
          // 调用开放地理编码API
          fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(keyword)}&limit=5&addressdetails=1`)
            .then(response => response.json())
            .then(results => {
              searchResults.innerHTML = '';
              
              results.forEach(place => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result';
                
                // 构建地址信息
                let address = '';
                if (place.address.city) address += place.address.city + ', ';
                if (place.address.district) address += place.address.district + ', ';
                if (place.address.road) address += place.address.road;
                if (!address) address = '地址未知';
                
                resultItem.innerHTML = `
                  <div class="flex items-start">
                    <i class="fa fa-map-marker text-primary mt-0.5 mr-3"></i>
                    <div>
                      <h3 class="font-medium">${place.display_name.split(',')[0]}</h3>
                      <p class="text-xs text-gray-300 mt-0.5">${address}</p>
                    </div>
                  </div>
                `;
                
                resultItem.addEventListener('click', function() {
                  const isStart = input.id === 'startPoint';
                  input.value = place.display_name.split(',')[0];
                  
                  // 添加标记
                  const markerIcon = isStart 
                    ? L.divIcon({
                        html: '<div class="w-5 h-5 bg-primary rounded-full border-2 border-white shadow-lg"></div>',
                        className: 'custom-marker',
                        iconSize: [10, 10]
                      })
                    : L.divIcon({
                        html: '<div class="w-5 h-5 bg-danger rounded-full border-2 border-white shadow-lg"></div>',
                        className: 'custom-marker',
                        iconSize: [10, 10]
                      });
                  
                  const marker = L.marker([place.lat, place.lon], { icon: markerIcon }).addTo(map);
                  
                  if (isStart) {
                    if (startMarker) map.removeLayer(startMarker);
                    startMarker = marker;
                  } else {
                    if (endMarker) map.removeLayer(endMarker);
                    endMarker = marker;
                  }
                  
                  searchResults.classList.add('hidden');
                });
                
                searchResults.appendChild(resultItem);
              });
            })
            .catch(error => {
              console.error('搜索失败:', error);
              showToast('搜索失败，请重试');
            });
        });
      });

      // 搜索导航路线
      searchBtn.addEventListener('click', function() {
        const startVal = startPoint.value.trim();
        const endVal = endPoint.value.trim();
        
        if (!startVal || !endVal) {
          showToast('请输入起点和终点');
          return;
        }
        
        // 清除已有路线
        if (routingControl) {
          map.removeControl(routingControl);
          routingControl = null;
        }
        
        // 获取起点坐标
        let startCoords;
        if (startVal === '我的位置' && currentPosition) {
          startCoords = currentPosition;
        } else {
          // 解析起点地址
          startCoords = new Promise((resolve) => {
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(startVal)}&limit=1`)
              .then(response => response.json())
              .then(results => {
                if (results.length > 0) {
                  resolve([results[0].lat, results[0].lon]);
                } else {
                  showToast('无法找到起点位置');
                  resolve(null);
                }
              });
          });
        }
        
        // 获取终点坐标
        const endCoords = new Promise((resolve) => {
          fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(endVal)}&limit=1`)
            .then(response => response.json())
            .then(results => {
              if (results.length > 0) {
                resolve([results[0].lat, results[0].lon]);
              } else {
                showToast('无法找到终点位置');
                resolve(null);
              }
            });
        });
        
        // 等待坐标解析完成
        Promise.all([startCoords, endCoords]).then(coords => {
          const [start, end] = coords;
          
          if (!start || !end) return;
          
          // 创建路线规划控件
          routingControl = L.Routing.control({
            waypoints: [
              L.latLng(start[0], start[1]),
              L.latLng(end[0], end[1])
            ],
            routeWhileDragging: false,
            showAlternatives: false,
            lineOptions: {
              styles: [{
                color: '#2574A9',
                weight: 5,
                opacity: 0.8
              }]
            },
            createMarker: function(i, waypoint, n) {
              // 自定义标记
              const icon = i === 0 
                ? L.divIcon({
                    html: '<div class="w-6 h-6 bg-primary rounded-full border-2 border-white shadow-lg"></div>',
                    className: 'custom-marker',
                    iconSize: [12, 12]
                  })
                : L.divIcon({
                    html: '<div class="w-6 h-6 bg-danger rounded-full border-2 border-white shadow-lg"></div>',
                    className: 'custom-marker',
                    iconSize: [12, 12]
                  });
              
              return L.marker(waypoint.latLng, { icon: icon });
            }
          }).addTo(map);
          
          // 路线计算完成后处理
          routingControl.on('routesfound', function(e) {
            const routes = e.routes;
            const summary = routes[0].summary;
            const distance = routes[0].distance / 1000; // 转换为公里
            const duration = Math.ceil(routes[0].duration / 60); // 转换为分钟
            
            // 更新路线信息
            routeDistance.textContent = distance.toFixed(1) + ' 公里';
            routeDuration.textContent = duration + ' 分钟';
            
            // 估算红绿灯数量（基于路线步骤）
            const lightsCount = Math.floor(routes[0].instructions.length / 4);
            routeLights.textContent = lightsCount + ' 个';
            
            // 估算油耗
            routeFuel.textContent = (distance * 8).toFixed(1) + ' 升';
            
            // 更新路线步骤
            routeSteps.innerHTML = '';
            routes[0].instructions.forEach((instr, index) => {
              // 跳过最后一个"到达目的地"的重复步骤
              if (index === routes[0].instructions.length - 1) return;
              
              const stepItem = document.createElement('div');
              stepItem.className = 'flex items-start p-2 rounded-lg hover:bg-white/5 transition-all duration-300 animate-fade-in';
              stepItem.style.animationDelay = `${index * 0.05}s`;
              
              // 根据步骤类型选择图标
              let icon = 'fa-arrow-right';
              if (instr.includes('右转')) icon = 'fa-arrow-right';
              if (instr.includes('左转')) icon = 'fa-arrow-left';
              if (instr.includes('直行')) icon = 'fa-arrow-up';
              if (instr.includes('掉头')) icon = 'fa-repeat';
              if (instr.includes('到达')) icon = 'fa-flag-checkered';
              
              stepItem.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary flex-shrink-0 mt-0.5">
                  <i class="fa ${icon}"></i>
                </div>
                <div class="ml-3 flex-1">
                  <p class="text-sm">${instr}</p>
                </div>
              `;
              
              routeSteps.appendChild(stepItem);
            });
            
            // 显示路线信息面板
            showRouteInfo();
          });
        });
      });

      // 地图控制按钮
      zoomIn.addEventListener('click', function() {
        map.zoomIn();
        addButtonEffect(this);
      });

      zoomOut.addEventListener('click', function() {
        map.zoomOut();
        addButtonEffect(this);
      });

      myLocation.addEventListener('click', function() {
        if (currentPosition) {
          map.setView(currentPosition, 15);
          addButtonEffect(this);
        } else {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              currentPosition = [position.coords.latitude, position.coords.longitude];
              map.setView(currentPosition, 15);
            },
            () => showToast('无法获取位置信息')
          );
        }
      });

      mapTypeBtn.addEventListener('click', function() {
        // 清除现有图层
        map.eachLayer(layer => {
          if (layer instanceof L.TileLayer) {
            map.removeLayer(layer);
          }
        });
        
        // 切换地图类型
        if (mapStyle === 'dark') {
          mapStyle = 'light';
          L.tileLayer(lightMapUrl, {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(map);
          this.innerHTML = '<i class="fa fa-map-o"></i>';
        } else {
          mapStyle = 'dark';
          L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
          }).addTo(map);
          this.innerHTML = '<i class="fa fa-map"></i>';
        }
        
        addButtonEffect(this);
      });

      // 路线信息面板控制
      toggleRouteBtn.addEventListener('click', function() {
        if (isRouteVisible) {
          hideRouteInfo();
        } else {
          showRouteInfo();
        }
        addButtonEffect(this);
      });

      closeRouteBtn.addEventListener('click', function() {
        hideRouteInfo();
        addButtonEffect(this);
      });

      startNavBtn.addEventListener('click', function() {
        showToast('开始导航');
        addButtonEffect(this);
      });

      // 路线类型切换
      routeTypeBtns.forEach((btn, index) => {
        btn.addEventListener('click', function() {
          // 更新按钮样式
          routeTypeBtns.forEach(b => {
            b.classList.remove('active', 'bg-primary/20', 'border-primary/30');
            b.classList.add('bg-white/5', 'border-white/10');
          });
          
          this.classList.add('active', 'bg-primary/20', 'border-primary/30');
          this.classList.remove('bg-white/5', 'border-white/10');
          
          // 更新路线类型
          const types = ['driving', 'transit', 'walking'];
          routeType = types[index];
          showToast(`已切换为${this.textContent.trim()}路线`);
          
          // 如果已有起点终点，重新计算路线
          if (startPoint.value.trim() && endPoint.value.trim()) {
            searchBtn.click();
          }
          
          addButtonEffect(this);
        });
      });

      // 主题切换（深色/浅色）
      themeToggle.addEventListener('click', function() {
        const body = document.body;
        
        if (this.innerHTML.includes('moon')) {
          // 切换到浅色主题
          this.innerHTML = '<i class="fa fa-sun-o"></i>';
          body.classList.remove('from-slate-900', 'via-indigo-950', 'to-slate-800');
          body.classList.add('from-slate-100', 'via-blue-50', 'to-slate-200');
          document.querySelectorAll('.glass-dark').forEach(el => {
            el.classList.remove('glass-dark');
            el.classList.add('glass');
          });
          document.querySelectorAll('h1, h2, h3, p, span').forEach(el => {
            el.classList.add('text-gray-800');
            el.classList.remove('text-white');
          });
        } else {
          // 切换到深色主题
          this.innerHTML = '<i class="fa fa-moon-o"></i>';
          body.classList.remove('from-slate-100', 'via-blue-50', 'to-slate-200');
          body.classList.add('from-slate-900', 'via-indigo-950', 'to-slate-800');
          document.querySelectorAll('.glass:not(.glass-dark)').forEach(el => {
            el.classList.remove('glass');
            el.classList.add('glass-dark');
          });
          document.querySelectorAll('h1, h2, h3, p, span').forEach(el => {
            el.classList.remove('text-gray-800');
            el.classList.add('text-white');
          });
        }
        
        addButtonEffect(this);
      });

      // 显示路线信息
      function showRouteInfo() {
        routeInfo.classList.remove('translate-y-full');
        routeChevron.classList.remove('fa-chevron-up');
        routeChevron.classList.add('fa-chevron-down');
        isRouteVisible = true;
      }

      // 隐藏路线信息
      function hideRouteInfo() {
        routeInfo.classList.add('translate-y-full');
        routeChevron.classList.remove('fa-chevron-down');
        routeChevron.classList.add('fa-chevron-up');
        isRouteVisible = false;
      }

      // 显示提示消息
      function showToast(message) {
        // 移除已有toast
        let toast = document.getElementById('toast');
        if (toast) toast.remove();
        
        // 创建新toast
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 glass-dark px-4 py-2 rounded-full text-sm z-50 animate-slide-up';
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 3秒后消失
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translate(-50%, 20px)';
          toast.style.transition = 'opacity 0.3s, transform 0.3s';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // 添加按钮点击效果
      function addButtonEffect(button) {
        button.classList.add('scale-95');
        setTimeout(() => button.classList.remove('scale-95'), 150);
      }

      // 初始化隐藏路线信息
      hideRouteInfo();
    });
  </script>
</body>
</html>
